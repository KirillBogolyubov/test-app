{"ast":null,"code":"import { computed, ref } from \"vue\";\nexport default {\n  __name: 'App',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const price = ref(0);\n    const quantity = ref(0);\n    const amount = ref(0);\n    const counter = ref(0);\n    const events = ref([]);\n    // const previewData = ref({});\n    // const isPreview = ref(false)\n    const localStorageData = computed(() => {\n      return JSON.parse(localStorage.getItem('data') || '{}');\n    });\n    const calculateFields = changedField => {\n      setTimeout(() => {\n        if (changedField === 'price' || changedField === 'quantity') {\n          amount.value = price.value * quantity.value;\n        } else if (changedField === 'amount') {\n          if (price.value) {\n            quantity.value = amount.value / price.value;\n          } else if (quantity.value) {\n            price.value = amount.value / quantity.value;\n          }\n        }\n      }, 300);\n      saveEvent(`Изменено поле: ${changedField}`, {\n        price: price.value,\n        quantity: quantity.value,\n        amount: amount.value\n      });\n    };\n    const saveEvent = (message, data = null) => {\n      const event = {\n        message,\n        data\n      };\n      events.value.unshift(event);\n    };\n    const postAmount = () => {\n      const data = {\n        counter: counter.value++,\n        price: price.value,\n        quantity: quantity.value,\n        amount: amount.value\n      };\n      saveEvent('Отправка данных', {\n        submitted: data.value,\n        localStorageBefore: localStorage.getItem('data')\n      });\n      console.log(localStorage.getItem('data') || '{}');\n      serverRequest(data).then(res => {\n        // localStorage.setItem('data', JSON.stringify(data))\n        saveEvent('Response', {\n          res,\n          localStorageAfter: localStorage.getItem('data') || '{}'\n        });\n      }).catch(err => {\n        saveEvent('Response', {\n          err\n        });\n        throw new Error(err.message);\n      });\n    };\n    const serverRequest = data => {\n      return new Promise((resolve, reject) => {\n        setTimeout(() => {\n          const isSuccessRequest = data.amount % 2 === 0;\n          if (isSuccessRequest) {\n            localStorage.setItem('data', JSON.stringify(data));\n            resolve({\n              success: true\n            });\n          } else {\n            reject({\n              success: false\n            });\n          }\n        }, 1000);\n      });\n    };\n    const __returned__ = {\n      price,\n      quantity,\n      amount,\n      counter,\n      events,\n      localStorageData,\n      calculateFields,\n      saveEvent,\n      postAmount,\n      serverRequest,\n      computed,\n      ref\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["computed","ref","price","quantity","amount","counter","events","localStorageData","JSON","parse","localStorage","getItem","calculateFields","changedField","setTimeout","value","saveEvent","message","data","event","unshift","postAmount","submitted","localStorageBefore","console","log","serverRequest","then","res","localStorageAfter","catch","err","Error","Promise","resolve","reject","isSuccessRequest","setItem","stringify","success"],"sources":["/Users/kirill/WebstormProjects/test-app/src/App.vue"],"sourcesContent":["<template>\n  <section>\n    <form class=\"form\">\n      <div class=\"form__input\">\n        <input id=\"price\" v-model=\"price\" type=\"number\" @input=\"calculateFields('price')\" />\n        <label for=\"price\">Цена</label>\n      </div>\n      <div class=\"form__input\">\n        <input id=\"quantity\" v-model=\"quantity\" type=\"number\" @input=\"calculateFields('quantity')\" />\n        <label for=\"quantity\">Количество</label>\n      </div>\n      <div class=\"form__input\">\n        <input id=\"amount\" v-model=\"amount\" @input=\"calculateFields('amount')\" />\n        <label for=\"amount\">Сумма</label>\n      </div>\n      <button @click.stop.prevent=\"postAmount\">Отправить</button>\n    </form>\n    <div>localStorage: {{localStorageData}}</div>\n    <div v-for=\"(item, index) in events\" :key=\"index\">{{item.message}}</div>\n  </section>\n</template>\n\n<script setup>\nimport {computed, ref} from \"vue\";\n\nconst price = ref(0);\nconst quantity = ref(0);\nconst amount = ref(0);\nconst counter = ref(0);\nconst events = ref([]);\n// const previewData = ref({});\n// const isPreview = ref(false)\nconst localStorageData = computed(() => {\n  return JSON.parse(localStorage.getItem('data') || '{}')\n});\n\n\nconst calculateFields = (changedField) => {\n  setTimeout(() => {\n    if (changedField === 'price' || changedField === 'quantity') {\n      amount.value = price.value * quantity.value\n    }\n    else if (changedField === 'amount') {\n      if (price.value) {\n        quantity.value = amount.value / price.value\n      } else if (quantity.value) {\n        price.value = amount.value / quantity.value\n      }\n    }\n  }, 300)\n  saveEvent(`Изменено поле: ${changedField}`, {\n    price: price.value,\n    quantity: quantity.value,\n    amount: amount.value\n  })\n}\n\nconst saveEvent = (message, data = null) => {\n  const event = {\n    message,\n    data\n  }\n  events.value.unshift(event)\n}\n\nconst postAmount = () => {\n  const data = {\n    counter: counter.value++,\n    price: price.value,\n    quantity: quantity.value,\n    amount: amount.value,\n  }\n\n  saveEvent('Отправка данных', {\n    submitted: data.value,\n    localStorageBefore: localStorage.getItem('data')\n  })\n  console.log(localStorage.getItem('data') || '{}')\n\n  serverRequest(data).then((res) => {\n    // localStorage.setItem('data', JSON.stringify(data))\n    saveEvent('Response', {\n      res,\n      localStorageAfter: localStorage.getItem('data') || '{}'\n    })\n  }).catch(err => {\n    saveEvent('Response', {err})\n    throw new Error(err.message)\n  })\n\n}\n\nconst serverRequest = (data) => {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      const isSuccessRequest = data.amount % 2 === 0\n\n      if (isSuccessRequest) {\n        localStorage.setItem('data', JSON.stringify(data))\n        resolve({success: true})\n      } else {\n        reject({success: false})\n      }\n    }, 1000)\n  })\n}\n</script>\n\n<style lang=\"scss\">\n#app {\n  font-family: Avenir, Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: center;\n  color: #2c3e50;\n  margin-top: 60px;\n}\n\n.form {\n  display: flex;\n  column-gap: 10px;\n  margin-bottom: 20px;\n\n  &__input {\n    display: flex;\n    flex-direction: column;\n  }\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}